<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVW Case Reports Analytics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;}
body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .login-container {
        max-width: 400px;
        margin: 10% auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        padding: 40px;
        text-align: center;
    }

    .login-header h1 {
        color: #2c3e50;
        font-size: 2rem;
        margin-bottom: 10px;
    }

    .login-header p {
        color: #7f8c8d;
        font-size: 1rem;
        margin-bottom: 30px;
    }

    .login-input {
        width: 100%;
        padding: 15px;
        margin-bottom: 15px;
        border: 2px solid #dee2e6;
        border-radius: 10px;
        font-size: 16px;
    }

    .login-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
    }

    .demo-accounts {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
    }

    .demo-accounts h3 {
        color: #2c3e50;
        margin-bottom: 15px;
    }

    .account-demo {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 8px;
        background: white;
        border-radius: 5px;
        font-size: 0.9rem;
    }

    .login-error {
        background: #fee2e2;
        color: #dc2626;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 15px;
        display: none;
    }

    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #667eea;
    }

    .header h1 {
        color: #2c3e50;
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .user-info-bar {
        background: rgba(255, 255, 255, 0.9);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logout-btn {
        padding: 8px 16px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .agency-selection {
        text-align: center;
        margin-bottom: 20px;
    }

    .agency-btn {
        background: white;
        border: 3px solid #dee2e6;
        border-radius: 15px;
        padding: 20px;
        margin: 10px;
        cursor: pointer;
        display: inline-block;
        min-width: 200px;
    }

    .agency-btn.selected {
        border-color: #667eea;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
    }

    .action-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        color: white;
    }

    .action-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .add-record-btn {
        background: linear-gradient(135deg, #10b981, #059669);
    }

    .search-case-btn {
        background: linear-gradient(135deg, #17a2b8, #6f42c1);
    }

    .view-dashboard-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .kpi-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .kpi-card {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
    }

    .kpi-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .kpi-label {
        font-size: 1rem;
        opacity: 0.9;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background: white;
        margin: 2% auto;
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ecf0f1;
    }

    .close {
        color: #95a5a6;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        background: none;
        border: none;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-group label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
    }

    .form-group input,
    .form-group select {
        padding: 12px 15px;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        font-size: 14px;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 30px;
    }

    .cancel-btn {
        padding: 12px 24px;
        background: #95a5a6;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }

    .submit-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }

    .success-message {
        background: #d1fae5;
        color: #059669;
        padding: 12px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
    }

    .error-message {
        background: #fee2e2;
        color: #dc2626;
        padding: 12px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
    }

    .hidden {
        display: none !important;
    }

    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
        .action-buttons {
            flex-direction: column;
            align-items: center;
        }
    }
</style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-header">
            <h1>üîê CVW Dashboard</h1>
            <p>Zambia Child Victim & Witness Analytics</p>
        </div>
<div class="login-error" id="loginError">
        ‚ùå Invalid username or password
    </div>
    
    <form class="login-form" id="loginForm">
        <input type="text" id="username" class="login-input" placeholder="Username" required>
        <input type="password" id="password" class="login-input" placeholder="Password" required>
        <button type="submit" class="login-btn">üöÄ Login</button>
    </form>
    
    <div class="demo-accounts">
        <h3>üìã Demo Accounts</h3>
        <div class="account-demo">
            <span>üëë Admin</span>
            <span>admin / admin123</span>
        </div>
        <div class="account-demo">
            <span>üëÄ Viewer</span>
            <span>viewer / view123</span>
        </div>
        <div class="account-demo">
            <span>üìù Reporter</span>
            <span>reporter / report123</span>
        </div>
    </div>
</div>

<!-- Main Dashboard -->
<div id="mainDashboard" class="hidden">
    <div class="user-info-bar">
        <div>
            <strong id="userName">User</strong> - 
            <span id="userRole">Role</span>
        </div>
        <button class="logout-btn" onclick="logout()">üö™ Logout</button>
    </div>

    <div class="dashboard-container">
        <div class="header">
            <h1>üìä CVW Case Reports Analytics</h1>
            <p>Zambia Child Victim & Witness Analytics System</p>
        </div>

        <!-- Agency Selection -->
        <div id="agencySelection" class="agency-selection hidden">
            <h3>üèõÔ∏è Select Reporting Agency</h3>
            <button class="agency-btn" data-agency="NPA" onclick="selectAgency('NPA')">
                <div>‚öñÔ∏è</div>
                <div>National Prosecution Authority</div>
                <div>NPA</div>
            </button>
            <button class="agency-btn" data-agency="MOH" onclick="selectAgency('MOH')">
                <div>üè•</div>
                <div>Ministry of Health</div>
                <div>MOH</div>
            </button>
            <button class="agency-btn" data-agency="ZP" onclick="selectAgency('ZP')">
                <div>üëÆ</div>
                <div>Zambia Police</div>
                <div>ZP</div>
            </button>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-btn add-record-btn" id="addRecordBtn" onclick="openAddRecordModal()" disabled>
                ‚ûï Add New Record
            </button>
            <button class="action-btn search-case-btn" id="searchCaseBtn" onclick="openSearchCaseModal()" disabled>
                üîç Search Case
            </button>
            <button class="action-btn view-dashboard-btn" onclick="showDashboard()">
                üìà View Dashboard
            </button>
        </div>

        <!-- KPI Section -->
        <div class="kpi-section" id="kpiSection">
            <div class="kpi-card">
                <div class="kpi-value" id="totalCases">0</div>
                <div class="kpi-label">Total Cases</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value" id="victimCases">0</div>
                <div class="kpi-label">Victim Cases</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value" id="witnessCases">0</div>
                <div class="kpi-label">Witness Cases</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value" id="avgAge">0</div>
                <div class="kpi-label">Average Age</div>
            </div>
        </div>

        <!-- Reporter Only Content -->
        <div id="reporterOnlyContent" class="hidden">
            <div style="text-align: center; padding: 50px; background: #f8f9fa; border-radius: 10px;">
                <h2>üìù Reporter Dashboard</h2>
                <p>Welcome! You can add new case records and search existing cases.</p>
                <p><strong>Step 1:</strong> Select your reporting agency above</p>
                <p><strong>Step 2:</strong> Click "Add New Record" or "Search Case"</p>
            </div>
        </div>
    </div>
</div>

<!-- Add Record Modal -->
<div id="addRecordModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚ûï Add New Case Record</h2>
            <button class="close" onclick="closeAddRecordModal()">&times;</button>
        </div>
        
        <div class="success-message" id="successMessage">
            ‚úÖ Record added successfully!
        </div>
        
        <div class="error-message" id="errorMessage">
            ‚ùå Please fill in all required fields.
        </div>

        <form id="addRecordForm">
            <div class="form-grid">
                <div class="form-group">
                    <label>Case ID</label>
                    <input type="text" id="caseId" readonly placeholder="Auto-generated">
                </div>
                
                <div class="form-group">
                    <label>Record Type *</label>
                    <select id="recordType" required onchange="generateCaseId()">
                        <option value="">Select Type</option>
                        <option value="Victim">Victim</option>
                        <option value="Witness">Witness</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Date Reported *</label>
                    <input type="date" id="dateReported" required>
                </div>
                
                <div class="form-group">
                    <label>District *</label>
                    <select id="district" required>
                        <option value="">Select District</option>
                        <option value="Lusaka">Lusaka</option>
                        <option value="Kitwe">Kitwe</option>
                        <option value="Solwezi">Solwezi</option>
                        <option value="Katete">Katete</option>
                        <option value="Chipata">Chipata</option>
                        <option value="Mansa">Mansa</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>CVW Gender *</label>
                    <select id="cvwGender" required>
                        <option value="">Select Gender</option>
                        <option value="MALE">Male</option>
                        <option value="FEMALE">Female</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>CVW Age *</label>
                    <input type="number" id="cvwAge" min="0" max="18" required placeholder="Age in years">
                </div>
                
                <div class="form-group">
                    <label>Crime Type *</label>
                    <select id="crimeType" required>
                        <option value="">Select Crime Type</option>
                        <option value="ASSAULT ON A CHILD">Assault on a Child</option>
                        <option value="PHYSICAL ABUSE">Physical Abuse</option>
                        <option value="SEXUAL ASSAULT">Sexual Assault</option>
                        <option value="RAPE">Rape</option>
                        <option value="CHILD NEGLECT">Child Neglect</option>
                        <option value="DEFILEMENT">Defilement</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Services Rendered</label>
                    <select id="servicesRendered">
                        <option value="">Select Services</option>
                        <option value="MEDICAL REPORT">Medical Report</option>
                        <option value="COUNSELLING">Counselling</option>
                        <option value="MEDICAL + COUNSELLING">Medical + Counselling</option>
                    </select>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="cancel-btn" onclick="closeAddRecordModal()">Cancel</button>
                <button type="submit" class="submit-btn">Add Record</button>
            </div>
        </form>
    </div>
</div>

<!-- Search Case Modal -->
<div id="searchCaseModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üîç Search Case by ID</h2>
            <button class="close" onclick="closeSearchCaseModal()">&times;</button>
        </div>
        
        <div class="form-group">
            <label>Enter Case ID</label>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="searchCaseId" placeholder="e.g., NPA-CV1, MOH-CW5" style="flex: 1;">
                <button onclick="searchCase()" style="padding: 12px 20px; background: #17a2b8; color: white; border: none; border-radius: 8px;">
                    üîç Search
                </button>
            </div>
        </div>

        <div id="caseDetailsSection" class="hidden" style="margin-top: 20px;">
            <h3>üìã Case Details</h3>
            <div id="caseDetails" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 10px;">
                <!-- Case details will be displayed here -->
            </div>
        </div>
        
        <div class="form-actions">
            <button type="button" class="cancel-btn" onclick="closeSearchCaseModal()">Close</button>
        </div>
    </div>
</div>

<script>
    let allData = [];
    let currentUser = null;
    let selectedAgency = null;

    const users = {
        'admin': { 
            password: 'admin123', 
            role: 'admin', 
            name: 'Administrator',
            permissions: ['view', 'add', 'edit', 'delete', 'admin']
        },
        'viewer': { 
            password: 'view123', 
            role: 'viewer', 
            name: 'Data Viewer',
            permissions: ['view']
        },
        'reporter': { 
            password: 'report123', 
            role: 'reporter', 
            name: 'Case Reporter',
            permissions: ['add']
        }
    };

    function login(username, password) {
        console.log('üîê Login attempt:', username);
        
        const user = users[username];
        if (user && user.password === password) {
            console.log('‚úÖ Authentication successful');
            currentUser = { username: username, ...user };
            
            localStorage.setItem('cvw_session', JSON.stringify(currentUser));
            updateUserInterface();
            showMainDashboard();
            return true;
        }
        
        console.log('‚ùå Authentication failed');
        return false;
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('cvw_session');
        showLoginScreen();
    }

    function updateUserInterface() {
        if (!currentUser) return;

        document.getElementById('userName').textContent = currentUser.name;
        document.getElementById('userRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);

        const role = currentUser.role;
        
        if (role === 'admin') {
            document.getElementById('agencySelection').classList.remove('hidden');
            document.getElementById('kpiSection').classList.remove('hidden');
            document.getElementById('reporterOnlyContent').classList.add('hidden');
        } else if (role === 'viewer') {
            document.getElementById('agencySelection').classList.add('hidden');
            document.getElementById('kpiSection').classList.remove('hidden');
            document.getElementById('reporterOnlyContent').classList.add('hidden');
        } else if (role === 'reporter') {
            document.getElementById('agencySelection').classList.remove('hidden');
            document.getElementById('kpiSection').classList.add('hidden');
            document.getElementById('reporterOnlyContent').classList.remove('hidden');
        }

        selectedAgency = null;
        document.getElementById('addRecordBtn').disabled = true;
        document.getElementById('searchCaseBtn').disabled = true;
    }

    function showLoginScreen() {
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('mainDashboard').classList.add('hidden');
    }

    function showMainDashboard() {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('mainDashboard').classList.remove('hidden');
        loadData();
    }

    function showDashboard() {
        loadData();
    }

    function selectAgency(agency) {
        selectedAgency = agency;
        
        document.querySelectorAll('.agency-btn').forEach(btn => {
            btn.classList.remove('selected');
        });
        document.querySelector('[data-agency="' + agency + '"]').classList.add('selected');
        
        document.getElementById('addRecordBtn').disabled = false;
        document.getElementById('searchCaseBtn').disabled = false;
        
        console.log('üìã Selected agency:', agency);
    }

    function loadData() {
        const savedData = localStorage.getItem('cvw_dashboard_data');
        if (savedData) {
            allData = JSON.parse(savedData);
        } else {
            allData = [
                {
                    'cvw code': 'NPA-CV1',
                    'Record Type': 'Victim',
                    'Date Reported': '2025-01-04',
                    'District': 'Lusaka',
                    'CVW Gender': 'MALE',
                    'CVW Age': 5,
                    'Crime Type': 'ASSAULT ON A CHILD',
                    'Services Rendered': 'MEDICAL REPORT'
                },
                {
                    'cvw code': 'MOH-CV2',
                    'Record Type': 'Victim',
                    'Date Reported': '2025-01-05',
                    'District': 'Kitwe',
                    'CVW Gender': 'FEMALE',
                    'CVW Age': 8,
                    'Crime Type': 'PHYSICAL ABUSE',
                    'Services Rendered': 'COUNSELLING'
                }
            ];
        }
        updateKPIs();
    }

    function saveData() {
        localStorage.setItem('cvw_dashboard_data', JSON.stringify(allData));
    }

    function updateKPIs() {
        const totalCases = allData.length;
        const victimCases = allData.filter(d => d['Record Type'] === 'Victim').length;
        const witnessCases = allData.filter(d => d['Record Type'] === 'Witness').length;
        const avgAge = allData.reduce((sum, d) => sum + d['CVW Age'], 0) / allData.length || 0;

        document.getElementById('totalCases').textContent = totalCases;
        document.getElementById('victimCases').textContent = victimCases;
        document.getElementById('witnessCases').textContent = witnessCases;
        document.getElementById('avgAge').textContent = Math.round(avgAge * 10) / 10;
    }

    function generateCaseId() {
        const recordType = document.getElementById('recordType').value;
        if (!recordType || !selectedAgency) {
            document.getElementById('caseId').value = '';
            return;
        }
        
        const suffix = recordType === 'Victim' ? 'CV' : 'CW';
        const prefix = selectedAgency + '-' + suffix;
        
        const existingIds = allData
            .filter(record => record['cvw code'].startsWith(prefix))
            .map(record => {
                const match = record['cvw code'].match(/(\d+)$/);
                return match ? parseInt(match[1]) : 0;
            });
        
        const nextNumber = existingIds.length > 0 ? Math.max(...existingIds) + 1 : 1;
        document.getElementById('caseId').value = prefix + nextNumber;
    }

    function openAddRecordModal() {
        if (!selectedAgency) {
            alert('‚ö†Ô∏è Please select a reporting agency first.');
            return;
        }
        
        document.getElementById('addRecordModal').style.display = 'block';
        document.getElementById('dateReported').value = new Date().toISOString().split('T')[0];
    }

    function closeAddRecordModal() {
        document.getElementById('addRecordModal').style.display = 'none';
        document.getElementById('addRecordForm').reset();
        hideMessages();
    }

    function openSearchCaseModal() {
        if (!selectedAgency) {
            alert('‚ö†Ô∏è Please select a reporting agency first.');
            return;
        }
        
        document.getElementById('searchCaseModal').style.display = 'block';
        document.getElementById('caseDetailsSection').classList.add('hidden');
    }

    function closeSearchCaseModal() {
        document.getElementById('searchCaseModal').style.display = 'none';
    }

    function searchCase() {
        const caseId = document.getElementById('searchCaseId').value.trim().toUpperCase();
        
        if (!caseId) {
            alert('Please enter a Case ID');
            return;
        }
        
        const foundCase = allData.find(record => record['cvw code'].toUpperCase() === caseId);
        
        if (foundCase) {
            displayCaseDetails(foundCase);
        } else {
            alert('Case ' + caseId + ' not found in the system.');
            document.getElementById('caseDetailsSection').classList.add('hidden');
        }
    }

    function displayCaseDetails(caseData) {
        const caseDetails = document.getElementById('caseDetails');
        caseDetails.innerHTML = 
            '<p><strong>Case ID:</strong> ' + caseData['cvw code'] + '</p>' +
            '<p><strong>Record Type:</strong> ' + caseData['Record Type'] + '</p>' +
            '<p><strong>Date Reported:</strong> ' + caseData['Date Reported'] + '</p>' +
            '<p><strong>District:</strong> ' + caseData['District'] + '</p>' +
            '<p><strong>Gender:</strong> ' + caseData['CVW Gender'] + '</p>' +
            '<p><strong>Age:</strong> ' + caseData['CVW Age'] + ' years</p>' +
            '<p><strong>Crime Type:</strong> ' + caseData['Crime Type'] + '</p>' +
            '<p><strong>Services:</strong> ' + (caseData['Services Rendered'] || 'None recorded') + '</p>';
        
        document.getElementById('caseDetailsSection').classList.remove('hidden');
    }

    function showSuccessMessage(message) {
        const successMsg = document.getElementById('successMessage');
        if (successMsg) {
            successMsg.textContent = message;
            successMsg.style.display = 'block';
            setTimeout(function() {
                successMsg.style.display = 'none';
            }, 3000);
        }
    }

    function showErrorMessage(message) {
        const errorMsg = document.getElementById('errorMessage');
        if (errorMsg) {
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
            setTimeout(function() {
                errorMsg.style.display = 'none';
            }, 5000);
        }
    }

    function hideMessages() {
        const successMsg = document.getElementById('successMessage');
        const errorMsg = document.getElementById('errorMessage');
        if (successMsg) successMsg.style.display = 'none';
        if (errorMsg) errorMsg.style.display = 'none';
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ CVW Dashboard loaded');
        
        // Check for existing session
        const session = localStorage.getItem('cvw_session');
        if (session) {
            try {
                currentUser = JSON.parse(session);
                updateUserInterface();
                showMainDashboard();
            } catch (e) {
                localStorage.removeItem('cvw_session');
                showLoginScreen();
            }
        } else {
            showLoginScreen();
        }

        // Login form handler
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                
                if (!username || !password) {
                    document.getElementById('loginError').style.display = 'block';
                    document.getElementById('loginError').textContent = '‚ùå Please enter both username and password';
                    return;
                }
                
                if (login(username, password)) {
                    document.getElementById('loginError').style.display = 'none';
                } else {
                    document.getElementById('loginError').style.display = 'block';
                    document.getElementById('loginError').textContent = '‚ùå Invalid username or password';
                }
            });
        }

        // Add record form handler
        const addRecordForm = document.getElementById('addRecordForm');
        if (addRecordForm) {
            addRecordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const recordData = {
                    caseId: document.getElementById('caseId').value,
                    recordType: document.getElementById('recordType').value,
                    dateReported: document.getElementById('dateReported').value,
                    district: document.getElementById('district').value,
                    cvwGender: document.getElementById('cvwGender').value,
                    cvwAge: document.getElementById('cvwAge').value,
                    crimeType: document.getElementById('crimeType').value,
                    servicesRendered: document.getElementById('servicesRendered').value
                };
                
                const requiredFields = ['recordType', 'dateReported', 'district', 'cvwGender', 'cvwAge', 'crimeType'];
                const missingFields = requiredFields.filter(function(field) {
                    return !recordData[field] || recordData[field].trim() === '';
                });
                
                if (missingFields.length > 0) {
                    showErrorMessage('Please fill in all required fields');
                    return;
                }
                
                if (!selectedAgency) {
                    showErrorMessage('‚ö†Ô∏è Please select a reporting agency first.');
                    return;
                }
                
                if (!recordData.caseId) {
                    generateCaseId();
                    recordData.caseId = document.getElementById('caseId').value;
                }
                
                // Add record to data
                const newRecord = {
                    'cvw code': recordData.caseId,
                    'Record Type': recordData.recordType,
                    'Date Reported': recordData.dateReported,
                    'District': recordData.district,
                    'CVW Gender': recordData.cvwGender,
                    'CVW Age': parseInt(recordData.cvwAge),
                    'Crime Type': recordData.crimeType,
                    'Services Rendered': recordData.servicesRendered || ''
                };
                
                allData.push(newRecord);
                saveData();
                updateKPIs();
                
                showSuccessMessage('‚úÖ Record added successfully! Case ID: ' + recordData.caseId);
                
                setTimeout(function() {
                    closeAddRecordModal();
                }, 2000);
            });
        }
    });

    // Modal click outside to close
    window.onclick = function(event) {
        const addModal = document.getElementById('addRecordModal');
        const searchModal = document.getElementById('searchCaseModal');
        
        if (event.target === addModal) {
            closeAddRecordModal();
        }
        if (event.target === searchModal) {
            closeSearchCaseModal();
        }
    };
</script>
</body>
</html></parameter>
</invoke>
</artifacts>

